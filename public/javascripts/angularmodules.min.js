var app=angular.module("Genesis",["ngRoute","ngCookies","angular-uuid","angular-loading-bar","cfp.loadingBarInterceptor"]),url="localhost:4000";app.config(["cfpLoadingBarProvider",function(cfpLoadingBarProvider){cfpLoadingBarProvider.includeSpinner=!0,cfpLoadingBarProvider.includeBar=!0,cfpLoadingBarProvider.latencyThreshold=50}]),app.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var modelSetter=$parse(attrs.fileModel).assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),app.directive("onFinishRender",function($timeout){return{restrict:"A",link:function(scope,element,attr){!0===scope.$last&&$timeout(function(){scope.$emit(attr.onFinishRender)})}}}),app.service("fileUpload",["$http",function($http){this.uploadFileToUrl=function(file,text,img,video,audio,uploadUrl){var fd=new FormData;fd.append("image",file),fd.append("body",text),fd.append("img",img),fd.append("video",video),fd.append("audio",audio);var date=new Date;fd.append("date",date),$http.post(uploadUrl,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data,status,headers,config){window.location="/social/list"}).error(function(){})}}]),app.service("devotionalUpload",["$http",function($http){this.uploadDevotionalToUrl=function(title,text,showDate,img,video,audio,uploadUrl){var fd=new FormData;fd.append("title",title),fd.append("body",text),fd.append("showDate",showDate),fd.append("img",img),fd.append("video",video),fd.append("audio",audio),$http.post(uploadUrl,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data,status,headers,config){window.location="/devotional/list"}).error(function(){alert("Error al Guardar")})}}]),app.service("devotionalPut",["$http",function($http){this.uploadDevotionalToUrl=function(title,text,showDate,img,video,audio,uploadUrl){var fd=new FormData;fd.append("title",title),fd.append("body",text),fd.append("showDate",showDate),fd.append("img",img),fd.append("video",video),fd.append("audio",audio),$http.put(uploadUrl,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data,status,headers,config){window.location="/devotional/list"}).error(function(){alert("Error al Guardar")})}}]),app.controller("addDevotionalController",function($scope,$http,$cookies,devotionalUpload){$scope.create=function(){var body=CKEDITOR.instances.textarea1.getData();if(void 0==$scope.title||void 0==body||void 0==$scope.date);else{var uploadUrl="http://"+url+"/api/devotional/"+$cookies.session;devotionalUpload.uploadDevotionalToUrl($scope.title,body,$scope.date,$scope.img,$scope.video,$scope.audio,uploadUrl)}}}),app.controller("editDevotionalController",function($scope,$http,$cookies,devotionalPut){var pathArray=window.location.pathname.split("/");$http.get("http://"+url+"/api/devotional/"+pathArray[3]).success(function(data,status,headers,config){$scope.title=data.title,$scope.body=data.body,$scope.date=data.showDate}).error(function(){alert("AJAX error in Devotionals")}),$scope.create=function(){var body=CKEDITOR.instances.textarea1.getData();if(void 0==$scope.title||void 0==body||void 0==$scope.date);else{var uploadUrl="http://"+url+"/api/devotional/"+pathArray[3]+"/"+$cookies.session;devotionalPut.uploadDevotionalToUrl($scope.title,body,$scope.date,$scope.img,$scope.video,$scope.audio,uploadUrl)}}}),app.controller("addUserController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session}}),app.controller("devotionalsController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography)}),app.controller("editUserController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography)}),app.controller("homeController",function($scope,$http,$cookies,fileUpload,uuid){$scope.session=function(){return void 0!=$cookies.session},void 0==$cookies.session&&void 0==$cookies.temporalSession&&($cookies.temporalSession=uuid.v4())}),app.controller("indexController",function($scope,$http,$cookies,fileUpload,uuid){$scope.session=function(){return void 0!=$cookies.session},$scope.post=function(){if(void 0==$scope.postText&&void 0==$scope.file);else if(void 0==$scope.postText&&($scope.postText=""),void 0!=$scope.file){new Date;uploadUrl="http://"+url+"/api/post/"+$cookies.session,fileUpload.uploadFileToUrl($scope.file,$scope.postText,!0,!1,!1,uploadUrl);$scope.postText=void 0,$scope.file=void 0,$scope.labelFile=void 0,$("#modal1").modal("close")}else{new Date;var uploadUrl="http://"+url+"/api/post/"+$cookies.session;fileUpload.uploadFileToUrl(void 0,$scope.postText,!1,!1,!1,uploadUrl);$scope.postText=void 0,$scope.file=void 0,$scope.labelFile=void 0,$("#modal1").modal("close")}},$scope.like=function(event){var post_id=event.delegateTarget.id;$http.get("/post/like/"+post_id).success(function(data,status,headers,config){202==status&&(event.delegateTarget.className="btn-floating btn-large waves-effect waves-light red tooltipped"),200==status&&(event.delegateTarget.className="btn-floating btn-large waves-effect waves-light black tooltipped")}).error(function(){alert("AJAX error in like Post")})},$scope.pray=function(event){var post_id=event.delegateTarget.id;$http.get("/post/pray/"+post_id).success(function(data,status,headers,config){202==status&&(event.delegateTarget.className="btn-floating btn-large waves-effect waves-light teal tooltipped"),200==status&&(event.delegateTarget.className="btn-floating btn-large waves-effect waves-light black tooltipped")}).error(function(){alert("AJAX error in pray Post")})},$scope.posts=[],$scope.numberOfPosts,$scope.delete=function(event){$scope.post_id=event.delegateTarget.id,$scope.url="/post/delete/"+$scope.post_id,$scope.title="Eliminar Publicación"}}),app.controller("loginController",function($scope,$http,$cookies){$scope.login=function(){if(null==$scope.email||null==$scope.pass)Materialize.toast("Datos Incompletos",4e3);else{var data={email:$scope.email,pass:$scope.pass};$http.post("/authenticate",data).then(function(response){window.location="/"},function(response){401===response.status&&Materialize.toast("Correo/Contraseña Erróneo",4e3)})}}}),app.controller("showDevotionalsController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.delete=function(event){$scope.devotional_id=event.delegateTarget.id,$scope.url="/devotional/delete/"+$scope.devotional_id,$scope.title="Eliminar Devocional"}}),app.controller("showPlaceController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.delete=function(event){$scope.place_id=event.delegateTarget.id,$scope.url="/place/delete/"+$scope.place_id,$scope.title="Eliminar Área"}}),app.controller("showUsersController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.delete=function(event){$scope.user_id=event.delegateTarget.id,$scope.url="/user/delete/"+$scope.user_id,$scope.title="Eliminar Misionero"}});