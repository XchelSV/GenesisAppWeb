var app=angular.module("Genesis",["ngRoute","ngCookies","angular-uuid","LocalStorageModule","angularMoment","angular-loading-bar","cfp.loadingBarInterceptor"]);app.config(function(localStorageServiceProvider){localStorageServiceProvider.setPrefix("Genesis").setStorageType("localStorage").setNotify(!0,!0)}),app.config(["cfpLoadingBarProvider",function(cfpLoadingBarProvider){cfpLoadingBarProvider.includeSpinner=!0,cfpLoadingBarProvider.includeBar=!0,cfpLoadingBarProvider.latencyThreshold=50}]),app.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var modelSetter=$parse(attrs.fileModel).assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),app.directive("onFinishRender",function($timeout){return{restrict:"A",link:function(scope,element,attr){!0===scope.$last&&$timeout(function(){scope.$emit(attr.onFinishRender)})}}}),app.service("fileUpload",["$http",function($http){this.uploadFileToUrl=function(file,id,name,text,img,video,audio,uploadUrl,posts){var fd=new FormData;fd.append("file",file),fd.append("id",id),fd.append("name",name),fd.append("body",text),fd.append("img",img),fd.append("video",video),fd.append("audio",audio);var date=new Date;fd.append("date",date),$http.post(uploadUrl,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data,status,headers,config){posts.unshift(data)}).error(function(){})}}]),app.controller("addUserController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography),$http.get("/place").success(function(data,status,headers,config){$scope.places=data}).error(function(data,status,headers,config){})}),app.controller("devotionalsController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography)}),app.controller("editUserController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography)}),app.controller("indexController",function($scope,$http,$cookies,fileUpload,uuid,localStorageService){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography),void 0==$cookies.session&&void 0==$cookies.temporalSession&&($cookies.temporalSession=uuid.v4()),$scope.posts=[],$scope.numberOfPosts,$http.get("/posts").success(function(data,status,headers,config){$scope.posts=data,$scope.numberOfPosts=data.length;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].like.length;j++)$cookies.session?$cookies.session==data[i].like[j]&&localStorageService.set("like"+data[i]._id,!0):$cookies.temporalSession==data[i].like[j]&&localStorageService.set("like"+data[i]._id,!0);for(var k=0;k<data[i].pray4You.length;k++)$cookies.session?$cookies.session==data[i].pray4You[k]&&localStorageService.set("pray"+data[i]._id,!0):$cookies.temporalSession==data[i].pray4You[k]&&localStorageService.set("pray"+data[i]._id,!0)}}).error(function(){alert("AJAX posts erros")}),$scope.morePosts=function(){$http.get("/posts/"+$scope.numberOfPosts).success(function(data,status,headers,config){if(0!=data.length){for(var l=0;l<data.length;l++)$scope.posts.push(data[l]);for(var i=0;i<data.length;i++){for(var j=0;j<data[i].like.length;j++)$cookies.session?$cookies.session==data[i].like[j]&&localStorageService.set("like"+data[i]._id,!0):$cookies.temporalSession==data[i].like[j]&&localStorageService.set("like"+data[i]._id,!0);for(var k=0;k<data[i].pray4You.length;k++)$cookies.session?$cookies.session==data[i].pray4You[k]&&localStorageService.set("pray"+data[i]._id,!0):$cookies.temporalSession==data[i].pray4You[k]&&localStorageService.set("pray"+data[i]._id,!0)}$scope.numberOfPosts=$scope.numberOfPosts+data.length}}).error(function(){alert("AJAX more posts error")})},$scope.accessToPost=function(user_id){return void 0!=$cookies.session&&$cookies.id==user_id},$scope.showPostDetails=function(id){$http.get("/post/"+id).success(function(data,status,headers,config){$scope.postDetails=data}).error(function(){alert("AJAX error in details Post")})},$scope.deletePost=function(id,img){$http.delete("/post/"+img+"/"+id).success(function(data,status,headers,config){var postDeleted=angular.element(document.querySelector("#post"+id));postDeleted.removeClass("animated fadeIn"),postDeleted.addClass("animated fadeOut"),angular.element(document.querySelector("#deleteModal")).modal("hide")}).error(function(){alert("AJAX error in details Post")})},$scope.showLikeTooltip=function(button_id){angular.element(document.querySelector("#like"+button_id)).tooltip("show")},$scope.showPrayTooltip=function(button_id){angular.element(document.querySelector("#pray"+button_id)).tooltip("show")},$scope.clearStorage=function(){localStorageService.clearAll()},$scope.getLikeButtonStatus=function(postId){return localStorageService.get("like"+postId)},$scope.getPrayButtonStatus=function(postId){return localStorageService.get("pray"+postId)},$scope.like=function(postId){if($cookies.session){userId=$cookies.session;$http.post("/post/like",{userId:userId,postId:postId}).success(function(data,status,headers,config){if(200==status){angular.element(document.querySelector("#likeModal")).modal("show");angular.element(document.querySelector("#like"+postId));localStorageService.set("like"+postId,!0)}202==status&&localStorageService.set("like"+postId,!1)}).error(function(){alert("AJAX error in post like")})}if($cookies.temporalSession){var userId=$cookies.temporalSession;$http.post("/post/like",{userId:userId,postId:postId}).success(function(data,status,headers,config){if(200==status){angular.element(document.querySelector("#likeModal")).modal("show");angular.element(document.querySelector("#like"+postId));localStorageService.set("like"+postId,!0)}202==status&&localStorageService.set("like"+postId,!1)}).error(function(){alert("AJAX error in post like")})}},$scope.pray4You=function(postId){if($cookies.session){userId=$cookies.session;$http.post("/post/pray",{userId:userId,postId:postId}).success(function(data,status,headers,config){if(200==status){angular.element(document.querySelector("#prayModal")).modal("show");angular.element(document.querySelector("#pray"+postId));localStorageService.set("pray"+postId,!0)}202==status&&localStorageService.set("pray"+postId,!1)}).error(function(){alert("AJAX error in post like")})}if($cookies.temporalSession){var userId=$cookies.temporalSession;$http.post("/post/pray",{userId:userId,postId:postId}).success(function(data,status,headers,config){if(200==status){angular.element(document.querySelector("#prayModal")).modal("show");angular.element(document.querySelector("#pray"+postId));localStorageService.set("pray"+postId,!0)}202==status&&localStorageService.set("pray"+postId,!1)}).error(function(){alert("AJAX error in post like")})}},$("#image-cropper").cropit({imageBackground:!0,imageBackgroundBorderWidth:15}),$(".download-btn").click(function(){var imageData=$("#image-cropper").cropit("export");window.open(imageData)}),$scope.crop_div=!1,$scope.show_img=function(){$scope.myFile=void 0,$scope.crop_div=!0},$scope.reset_img=function(){$scope.myFile=void 0,$scope.crop_div=!1},$scope.post=function(){var validate_img=$("#image-cropper").cropit("export");if(void 0!=$scope.postText||void 0!=validate_img&&0!=$scope.crop_div)if(void 0==$scope.postText&&($scope.postText=""),void 0!=validate_img&&1==$scope.crop_div){var date=new Date,post={file:file=$("#image-cropper").cropit("export"),id:$scope.id,name:$scope.name,body:$scope.postText,img:!0,video:!1,audio:!1,date:date};$http.post("/posts",post).success(function(data,status,headers,config){angular.element(document.querySelector("#postModal")).modal("hide"),$scope.postText="",$scope.myFile=void 0,$scope.crop_div=!1,$scope.posts.unshift(data),$scope.numberOfPosts++}).error(function(){alert("AJAX error in post")})}else{var date=new Date,file=void 0,post={file:file,id:$scope.id,name:$scope.name,body:$scope.postText,img:!1,video:!1,audio:!1,date:date};$http.post("/posts",post).success(function(data,status,headers,config){angular.element(document.querySelector("#postModal")).modal("hide"),$scope.postText="",$scope.myFile=void 0,$scope.crop_div=!1,$scope.posts.unshift(data),$scope.numberOfPosts++}).error(function(){alert("AJAX error in post")})}else;},$("#file1").change(function(){$("#file1").val()?($("#btn_file1").removeClass("btn-primary"),$("#btn_file1").removeClass("btn-success"),$("#btn_file1").removeClass("btn-danger"),$("#btn_file1").addClass("btn-success")):($("#btn_file1").removeClass("btn-primary"),$("#btn_file1").removeClass("btn-success"),$("#btn_file1").removeClass("btn-danger"),$("#btn_file1").addClass("btn-danger"))}),$("#file2").change(function(){$("#file2").val()?($("#btn_file2").removeClass("btn-primary"),$("#btn_file2").removeClass("btn-success"),$("#btn_file2").removeClass("btn-danger"),$("#btn_file2").addClass("btn-success")):($("#btn_file2").removeClass("btn-primary"),$("#btn_file2").removeClass("btn-success"),$("#btn_file2").removeClass("btn-danger"),$("#btn_file2").addClass("btn-danger"))}),$("#file3").change(function(){$("#file3").val()?($("#btn_file3").removeClass("btn-primary"),$("#btn_file3").removeClass("btn-success"),$("#btn_file3").removeClass("btn-danger"),$("#btn_file3").addClass("btn-success")):($("#btn_file3").removeClass("btn-primary"),$("#btn_file3").removeClass("btn-success"),$("#btn_file3").removeClass("btn-danger"),$("#btn_file3").addClass("btn-danger"))})}),app.controller("loginController",function($scope,$http,$cookies){$scope.cookiesAttempUser=$cookies.attempUser,$scope.cookiesAttempPass=$cookies.attempPass,$scope.login=function(){if(null==$scope.email||null==$scope.pass)Materialize.toast("Datos Incompletos",4e3);else{var data={email:$scope.email,pass:$scope.pass};$http.post("/authenticate",data).then(function(response){window.location="/"},function(response){401===response.status&&Materialize.toast("Correo/Contraseña Erróneo",4e3)})}}}),app.controller("showDevotionalsController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.sessionType=function(){return"true"==$scope.userType},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography),$scope.userType=decodeURIComponent($cookies.type),$http.get("/devotional").success(function(data,status,headers,config){$scope.devotionals=data}).error(function(data,status,headers,config){}),$scope.showDevotionalDetails=function(id){$http.get("/devotional/"+id).success(function(data,status,headers,config){$scope.devotionalDetails=data}).error(function(data,status,headers,config){})},$scope.deleteDevotional=function(id,img,audio,video){$http.delete("/devotional/"+id+"/"+img+"/"+audio+"/"+video).success(function(data,status,headers,config){var devotionalDeleted=angular.element(document.querySelector("#devotional"+id));devotionalDeleted.removeClass("animated fadeIn"),devotionalDeleted.addClass("animated fadeOut"),angular.element(document.querySelector("#deleteModal")).modal("hide")}).error(function(){alert("AJAX error in details devotional")})}}),app.controller("showUserController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.sessionType=function(){return"true"==$scope.userType},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography),$scope.userType=decodeURIComponent($cookies.type),$scope.place_choosen=function(place_id){$scope.place_id_selected=place_id,console.log($scope.place_id_selected)},$scope.delete_place=function(){$http.delete("/place/"+$scope.place_id_selected).success(function(data,status,headers,config){window.location.reload()}).error(function(data,status,headers,config){alert("Error, Place cant be deleted")})},$http.get("/place").success(function(data,status,headers,config){$scope.places=data}).error(function(data,status,headers,config){})}),app.controller("userPlaceController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.admin_session=function(){return"true"===$cookies.type},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography),$scope.showDetails=function(id){$http.get("/user/"+id).success(function(data,status,headers,config){$scope.userDetails=data;var userDate=new Date(data.birthday);$scope.userMonth=userDate.getMonth()+1,$scope.userDay=userDate.getDate()+1}).error(function(data,status,headers,config){})},$scope.deleteUser=function(){$http.delete("/user/"+$scope.userDetails._id).success(function(data,status,headers,config){window.location.reload()}).error(function(data,status,headers,config){alert("Error, User cant be deleted")})};var pathname=window.location.pathname.split("/");$http.get("/users/place/"+pathname[3]).success(function(data,status,headers,config){$scope.missionaries=data}).error(function(data,status,headers,config){})});