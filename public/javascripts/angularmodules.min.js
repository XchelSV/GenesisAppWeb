var app=angular.module("Genesis",["ngRoute","ngCookies","angular-uuid","LocalStorageModule","angularMoment","angular-loading-bar","cfp.loadingBarInterceptor"]);app.config(function(localStorageServiceProvider){localStorageServiceProvider.setPrefix("Genesis").setStorageType("localStorage").setNotify(!0,!0)}),app.config(["cfpLoadingBarProvider",function(cfpLoadingBarProvider){cfpLoadingBarProvider.includeSpinner=!0,cfpLoadingBarProvider.includeBar=!0,cfpLoadingBarProvider.latencyThreshold=50}]),app.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var modelSetter=$parse(attrs.fileModel).assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),app.directive("onFinishRender",function($timeout){return{restrict:"A",link:function(scope,element,attr){!0===scope.$last&&$timeout(function(){scope.$emit(attr.onFinishRender)})}}}),app.service("fileUpload",["$http",function($http){this.uploadFileToUrl=function(file,text,img,video,audio,uploadUrl){var fd=new FormData;fd.append("image",file),fd.append("body",text),fd.append("img",img),fd.append("video",video),fd.append("audio",audio);var date=new Date;fd.append("date",date),$http.post(uploadUrl,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(data,status,headers,config){}).error(function(){})}}]),app.controller("addUserController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography),$http.get("/place").success(function(data,status,headers,config){$scope.places=data}).error(function(data,status,headers,config){})}),app.controller("devotionalsController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography)}),app.controller("editUserController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography)}),app.controller("homeController",function($scope,$http,$cookies,fileUpload,uuid,localStorageService){$scope.session=function(){return void 0!=$cookies.session},void 0==$cookies.session&&void 0==$cookies.temporalSession&&($cookies.temporalSession=uuid.v4())}),app.controller("indexController",function($scope,$http,$cookies,fileUpload,uuid,localStorageService){$scope.session=function(){return void 0!=$cookies.session},$scope.post=function(){if(void 0==$scope.postText&&void 0==$scope.file);else if(void 0==$scope.postText&&($scope.postText=""),void 0!=$scope.file){new Date;uploadUrl="http://localhost:4000/api/post/"+$cookies.session,fileUpload.uploadFileToUrl($scope.file,$scope.postText,!0,!1,!1,uploadUrl);$scope.postText=void 0,$scope.file=void 0,$scope.labelFile=void 0,$("#modal1").modal("close")}else{new Date;var uploadUrl="http://localhost:4000/api/post/"+$cookies.session;fileUpload.uploadFileToUrl(void 0,$scope.postText,!1,!1,!1,uploadUrl);$scope.postText=void 0,$scope.file=void 0,$scope.labelFile=void 0,$("#modal1").modal("close")}},$scope.like=function(event){var post_id=event.delegateTarget.id;$http.get("/post/like/"+post_id).success(function(data,status,headers,config){202==status&&(event.delegateTarget.className="btn-floating btn-large waves-effect waves-light red tooltipped"),200==status&&(event.delegateTarget.className="btn-floating btn-large waves-effect waves-light black tooltipped")}).error(function(){alert("AJAX error in like Post")})},$scope.pray=function(event){var post_id=event.delegateTarget.id;$http.get("/post/pray/"+post_id).success(function(data,status,headers,config){202==status&&(event.delegateTarget.className="btn-floating btn-large waves-effect waves-light teal tooltipped"),200==status&&(event.delegateTarget.className="btn-floating btn-large waves-effect waves-light black tooltipped")}).error(function(){alert("AJAX error in pray Post")})},$scope.posts=[],$scope.numberOfPosts,$scope.morePosts=function(){$http.get("/posts/"+$scope.numberOfPosts).success(function(data,status,headers,config){if(0!=data.length){for(var l=0;l<data.length;l++)$scope.posts.push(data[l]);for(var i=0;i<data.length;i++){for(var j=0;j<data[i].like.length;j++)$cookies.session?$cookies.session==data[i].like[j]&&localStorageService.set("like"+data[i]._id,!0):$cookies.temporalSession==data[i].like[j]&&localStorageService.set("like"+data[i]._id,!0);for(var k=0;k<data[i].pray4You.length;k++)$cookies.session?$cookies.session==data[i].pray4You[k]&&localStorageService.set("pray"+data[i]._id,!0):$cookies.temporalSession==data[i].pray4You[k]&&localStorageService.set("pray"+data[i]._id,!0)}$scope.numberOfPosts=$scope.numberOfPosts+data.length}}).error(function(){alert("AJAX more posts error")})},$scope.accessToPost=function(user_id){return void 0!=$cookies.session&&$cookies.id==user_id},$scope.showPostDetails=function(id){$http.get("/post/"+id).success(function(data,status,headers,config){$scope.postDetails=data}).error(function(){alert("AJAX error in details Post")})},$scope.deletePost=function(id,img){$http.delete("/post/"+img+"/"+id).success(function(data,status,headers,config){var postDeleted=angular.element(document.querySelector("#post"+id));postDeleted.removeClass("animated fadeIn"),postDeleted.addClass("animated fadeOut"),angular.element(document.querySelector("#deleteModal")).modal("hide")}).error(function(){alert("AJAX error in details Post")})}}),app.controller("loginController",function($scope,$http,$cookies){$scope.login=function(){if(null==$scope.email||null==$scope.pass)Materialize.toast("Datos Incompletos",4e3);else{var data={email:$scope.email,pass:$scope.pass};$http.post("/authenticate",data).then(function(response){window.location="/"},function(response){401===response.status&&Materialize.toast("Correo/Contraseña Erróneo",4e3)})}}}),app.controller("showDevotionalsController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.sessionType=function(){return"true"==$scope.userType},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography),$scope.userType=decodeURIComponent($cookies.type),$http.get("/devotional").success(function(data,status,headers,config){$scope.devotionals=data}).error(function(data,status,headers,config){}),$scope.showDevotionalDetails=function(id){$http.get("/devotional/"+id).success(function(data,status,headers,config){$scope.devotionalDetails=data}).error(function(data,status,headers,config){})},$scope.deleteDevotional=function(id,img,audio,video){$http.delete("/devotional/"+id+"/"+img+"/"+audio+"/"+video).success(function(data,status,headers,config){var devotionalDeleted=angular.element(document.querySelector("#devotional"+id));devotionalDeleted.removeClass("animated fadeIn"),devotionalDeleted.addClass("animated fadeOut"),angular.element(document.querySelector("#deleteModal")).modal("hide")}).error(function(){alert("AJAX error in details devotional")})}}),app.controller("showPlaceController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.sessionType=function(){return"true"==$scope.userType},$scope.place_choosen=function(place_id){$scope.place_id_selected=place_id,console.log($scope.place_id_selected)},$scope.delete_place=function(){$http.delete("/place/"+$scope.place_id_selected).success(function(data,status,headers,config){window.location.reload()}).error(function(data,status,headers,config){alert("Error, Place cant be deleted")})}}),app.controller("userPlaceController",function($scope,$http,$cookies){$scope.session=function(){return void 0!=$cookies.session},$scope.admin_session=function(){return"true"===$cookies.type},$scope.id=decodeURIComponent($cookies.id),$scope.name=decodeURIComponent($cookies.name),$scope.day=decodeURIComponent($cookies.day),$scope.month=decodeURIComponent($cookies.month),$scope.servicePlace=decodeURIComponent($cookies.servicePlace),$scope.biography=decodeURIComponent($cookies.biography),$scope.showDetails=function(id){$http.get("/user/"+id).success(function(data,status,headers,config){$scope.userDetails=data;var userDate=new Date(data.birthday);$scope.userMonth=userDate.getMonth()+1,$scope.userDay=userDate.getDate()+1}).error(function(data,status,headers,config){})},$scope.deleteUser=function(){$http.delete("/user/"+$scope.userDetails._id).success(function(data,status,headers,config){window.location.reload()}).error(function(data,status,headers,config){alert("Error, User cant be deleted")})};var pathname=window.location.pathname.split("/");$http.get("/users/place/"+pathname[3]).success(function(data,status,headers,config){$scope.missionaries=data}).error(function(data,status,headers,config){})});